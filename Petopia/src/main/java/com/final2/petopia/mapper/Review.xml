<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd"> 

<mapper namespace="review">
	<!-- === 2019.01.28 ==== 리스트 하는 중... -->
	<!-- 병원 리스트 카운트 - 기간이 없는 -->
	<select id="selectTotalCount" parameterType="HashMap" resultType="int">
		select count(*) from chart
		where fk_idx = #{IDX}
	</select>
	
	<!-- 병원 리스트 카운트 - 기간이 있는 -->
	<select id="selectTotalCountByPeriod" parameterType="HashMap" resultType="int">
		select count(*)
		from chart
		where fk_idx = #{IDX} and trunc(months_between(sysdate, reservation_DATE)) <![CDATA[<]]> #{PERIOD}
	</select>
	
	<!-- 병원 리스트를 담는 HashMap -->
	<resultMap type="HashMap" id="hosListMap">
		<result property="RNO"				column="rno"				javaType="String"/>
		<result property="PET_PROFILEIMG"	column="pet_profileimg"		javaType="String"/>
		<result property="PET_NAME"			column="pet_name"			javaType="String"/>
		<result property="NAME"				column="name"				javaType="String"/>
		<result property="FILENAME"			column="fileName"			javaType="String"/>
		<result property="RESERVATION_DATE"	column="reservation_date"	javaType="String"/>
		<result property="DOC_NAME"			column="doc_name"			javaType="String"/>
		<result property="CHART_TYPE"		column="chart_type"			javaType="String"/>
	</resultMap>
	
	<!-- 병원 리스트 - 기간이 없는 -->
	<select id="selectHosList" parameterType="HashMap" resultMap="hosListMap">
		select rno, pet_profileimg, pet_name, name, fileName, reservation_date, doc_name, chart_type
		from
		(
		    select rownum as rno, pet_profileimg, pet_name, c.name, c.fileName, reservation_date, doc_name
		        , case chart_type when 1 then '진료' when 2 then '예방접종' when 3 then '수술' else '호텔링' end AS chart_type
		    from pet_info a JOIN chart b
		    ON a.pet_uid = b.fk_pet_uid
		    JOIN member c
		    ON b.biz_name = c.name
		    where b.fk_idx = #{IDX}
		    order by reservation_date desc
		) V
		where rno between #{START} and #{END}
	</select>
	
	<!-- 병원 리스트 - 기간이 있는 -->
	<select id="selectHosListByPeriod" parameterType="HashMap" resultMap="hosListMap">
		select rno, pet_profileimg, pet_name, name, fileName, reservation_date, doc_name, chart_type, period
		from
		(
		    select rownum as rno, pet_profileimg, pet_name, c.name, c.fileName, reservation_date, doc_name
		        , case chart_type when 1 then '진료' when 2 then '예방접종' when 3 then '수술' else '호텔링' end AS chart_type
		        , trunc(months_between(sysdate, reservation_DATE)) AS period
		    from pet_info a JOIN chart b
		    ON a.pet_uid = b.fk_pet_uid
		    JOIN member c
		    ON b.biz_name = c.name
		    where b.fk_idx = #{IDX} and trunc(months_between(sysdate, reservation_DATE)) <![CDATA[<]]> #{PERIOD}
		    order by reservation_date desc
		) V
		where rno between #{START} and #{END}
	</select>
	<!-- === 2019.01.28 ==== -->
</mapper>