<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd"> 

<mapper namespace="notification">

<!-- 회원의 고유번호를 이용한 안읽은 알림 갯수 나타내기 -->
<select id="selectUnreadNotificationCount" parameterType="int" resultType="int">
	select count(*)
	from notification
	where fk_idx = #{idx}
	and not_readcheck = 0
	and to_char(not_time, 'yyyy-mm-dd hh24:mi:ss') <![CDATA[<=]]> to_char(sysdate, 'yyyy-mm-dd hh24:mi:ss')
</select>

<!-- 회원의 고유번호를 이용한 심플 알림정보 가져오기(알림타입과 그 갯수) -->
<resultMap type="HashMap" id="selectNotificatioSimplenListMap">
	<result property="NOT_TYPE" column="not_type" javaType="String" />
	<result property="COUNT" column="count" javaType="String" />
</resultMap>

<select id="selectNotificatioSimplenList" parameterType="int" resultMap="selectNotificatioSimplenListMap">
	select not_type, count(not_type) as count
	from notification
	where fk_idx = #{idx}
	and not_readcheck = 0
	and to_char(not_time, 'yyyy-mm-dd hh24:mi:ss') <![CDATA[<=]]> to_char(sysdate, 'yyyy-mm-dd hh24:mi:ss')
	group by not_type
</select>

<!-- 알림 리스트 가져오기 -->
<select id="selectNotificatioList" parameterType="int" resultType="com.final2.petopia.model.NotificationVO">
	
	select  RNO AS NOT_UID, FK_IDX, NOT_TYPE, NOT_MESSAGE, NOT_DATE, 
			NOT_READCHECK, NOT_REMINDSTATUS, NOT_TIME, NOT_URL
	from
	(
		select 	ROWNUM AS RNO, NOT_UID, FK_IDX, NOT_TYPE, NOT_MESSAGE, NOT_DATE, 
				NOT_READCHECK, NOT_REMINDSTATUS, NOT_TIME, NOT_URL
		from notification
		where fk_idx = #{idx}
		and to_char(not_time, 'yyyy-mm-dd hh24:mi:ss') <![CDATA[<=]]> to_char(sysdate, 'yyyy-mm-dd hh24:mi:ss')
	) V
	order by NOT_UID desc
</select>


</mapper>